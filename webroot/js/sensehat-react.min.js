"use strict";function ownKeys(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s.push.apply(s,o)}return s}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(s),!0).forEach(function(e){_defineProperty(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):ownKeys(Object(s)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}function _defineProperty(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class App extends React.Component{constructor(t){super(t),this.state={boardState:[[],[],[],[],[],[],[],[]],boardHistory:[],boardHistoryStart:[[],[],[],[],[],[],[],[]],frames:[],selectedColour:"#7289DA",selectedTool:"brush",mouseDown:!1,showSentTooltip:!1,showFrameTooltip:!1,shiftHeld:!1,controlHeld:!1,altHeld:!1},this.submit=function(){let t,e,s=new XMLHttpRequest,o=this.props.mode,r="https://thor.sircinnamon.ca";if("history"==o?(t=r+"/sensehat/api/sequence",e=JSON.stringify({start:format_board(this.state.boardHistoryStart),sequence:format_sequence(this.state.boardHistory)})):"string"==o?(t=r+"/sensehat/api/string",e=JSON.stringify({string:this.props.dataParam})):"frames"==o?(t=r+"/sensehat/api/sequence",e=JSON.stringify({sequence:this.state.frames})):"flash"==o?(t=r+"/sensehat/api/flash",e=JSON.stringify({map:format_board(this.state.boardState)})):"spin"==o?(t=r+"/sensehat/api/spin",e=JSON.stringify({map:format_board(this.state.boardState)})):"scroll"==o?(t=r+"/sensehat/api/scroll",e=JSON.stringify({map:format_board(this.state.boardState)})):(t=r+"/sensehat/api/map",e=JSON.stringify({map:format_board(this.state.boardState)})),"withCredentials"in s)s.open("POST",t,!0);else{if("undefined"==typeof XDomainRequest)return;(s=new XDomainRequest).open("POST",t,!0)}let a=this;s.onreadystatechange=function(){this.readyState===XMLHttpRequest.DONE&&200===this.status&&(a.setState({showSentTooltip:!0}),setTimeout(function(){a.setState({showSentTooltip:!1})},3e3))},s.send(e)},this.keyChange=function(t,e=!1){if("Shift"==t.key)this.setState({shiftHeld:e});else if("Control"==t.key)this.setState({controlHeld:e});else if("Alt"==t.key)this.setState({altHeld:e});else if("s"==t.key&&e){let t=this.state.frames;t.push({map:format_board(this.state.boardState)}),this.setState({frames:t,showFrameTooltip:!0});let e=this;setTimeout(function(){e.setState({showFrameTooltip:!1})},3e3)}else if("S"==t.key&&e){let t=this.state.frames;t.pop(),this.setState({frames:t})}},this.updateBoard=function(t,e){let s=this.state.boardState;if(s[t.y][t.x]=e,this.setState({boardState:s}),this.state.boardHistory.length>0){let s=this.state.boardHistory[this.state.boardHistory.length-1];if(s&&s.x==t.x&&s.y==t.y&&s.colour==e)return}let o=this.state.boardHistory,r=this.state.boardHistoryStart;for(o.push({colour:e,x:t.x,y:t.y});o.length>256;){let t=o.shift();r[t.y][t.x]=t.colour}this.setState({boardHistory:o,boardHistoryStart:r})}}render(){return React.createElement("div",{onMouseDown:()=>{this.setState({mouseDown:!0})},onMouseUp:()=>{this.setState({mouseDown:!1})},onKeyDown:t=>{this.keyChange(t,!0)},onKeyUp:t=>{this.keyChange(t,!1)},tabIndex:-1,style:{border:"none",outline:"none"}},React.createElement(Board,{state:this.state.boardState,updateStateFn:((t,e)=>{this.updateBoard(t,e)}).bind(this),saveFrameFn:(t=>{this.setState({frames:this.state.frames.concat(t)})}).bind(this),setColourFn:(t=>{this.setState({selectedColour:t})}).bind(this),selectedColour:this.state.selectedColour,selectedTool:this.state.selectedTool,mouseDown:this.state.mouseDown,shiftHeld:this.state.shiftHeld,controlHeld:this.state.controlHeld,altHeld:this.state.altHeld}),React.createElement(Controls,{clearFn:(()=>{this.setState({boardState:[[],[],[],[],[],[],[],[]],boardHistory:[],boardHistoryStart:[[],[],[],[],[],[],[],[]],frames:[]})}).bind(this),setColourFn:(t=>{this.setState({selectedColour:t})}).bind(this),selectedColour:this.state.selectedColour,setToolFn:(t=>{this.setState({selectedTool:t})}).bind(this),submitFn:(()=>{console.log(this.state.boardState),this.submit()}).bind(this),selectedTool:this.state.selectedTool,showSentTooltip:this.state.showSentTooltip,showFrameTooltip:this.state.showFrameTooltip}),React.createElement("div",null,JSON.stringify(this.props),JSON.stringify(this.state)))}}class Board extends React.Component{constructor(t){super(t),this.state={},this.updateCell=function(t,e){let s=this.props.state;this.props.controlHeld?this.props.setColourFn(s[t][e]):"eraser"==this.props.selectedTool||this.props.shiftHeld?this.props.updateStateFn({x:e,y:t},null):"brush"==this.props.selectedTool&&this.props.updateStateFn({x:e,y:t},this.props.selectedColour)}}render(){let t=[];for(var e=0;e<8;e++){let s=React.createElement(Row,{key:"row"+e,index:e,updateCellFn:this.updateCell.bind(this),state:this.props.state[e],mouseDown:this.props.mouseDown});t=t.concat(s)}return React.createElement("div",{style:{boxSizing:"border-box",position:"relative",width:"84vmin",height:"84vmin",margin:"auto",padding:"2vmin",background:"#23272A"}},React.createElement("table",{style:{borderCollapse:"collapse",width:"80vmin",height:"80vmin",margin:"auto"}},React.createElement("tbody",null,t)))}}class Row extends React.Component{constructor(t){super(t),this.state={}}render(){let t=[];for(var e=0;e<8;e++){let s=React.createElement(Cell,{key:"cell"+this.props.index+"-"+e,row:this.props.index,column:e,updateCellFn:this.props.updateCellFn,state:this.props.state[e],mouseDown:this.props.mouseDown});t=t.concat(s)}return React.createElement("tr",null,t)}}class Cell extends React.Component{constructor(t){super(t),this.state={},this.onMouseMove=function(t){this.props.mouseDown&&(t.preventDefault(),this.onMouseDown(t))},this.onMouseDown=function(t){t.preventDefault(),this.props.updateCellFn(this.props.row,this.props.column)}}render(){let t="";this.props.state&&(t=`rgb(${(t=hexToRgb(this.props.state))[0]},${t[1]},${t[2]})`);let e={border:"2px solid #99AAB5",background:t};return React.createElement("td",{onMouseMove:this.onMouseMove.bind(this),onMouseDown:this.onMouseDown.bind(this),style:e})}}class Controls extends React.Component{constructor(t){super(t),this.state={},this.colorSelector=React.createRef()}componentDidMount(){forceColourChange=function(){this.props.setColourFn("#"+this.colorSelector.current.value)}.bind(this)}render(){let t={maxHeight:"10vmin",maxWidth:"10vmin",width:"10vmin",margin:"0vmin 1vmin"},e=_objectSpread(_objectSpread({},t),{},{float:"left",borderBottom:"brush"==this.props.selectedTool?"1vh solid #7289DA":"",borderRadius:"brush"==this.props.selectedTool?"1vh":""}),s=_objectSpread(_objectSpread({},t),{},{float:"left",borderTop:"eraser"==this.props.selectedTool?"1vh solid #7289DA":"",borderRadius:"eraser"==this.props.selectedTool?"1vh":""}),o={opacity:"0",userSelect:"none",width:"10vmin",fontSize:"3vmin",backgroundColor:"#43b581",color:"#fff",textAlign:"center",padding:"0.3vh 0",borderRadius:"6px",fontWeight:"bold",position:"absolute",zIndex:"1",top:"-55%",left:"calc(10%)",transition:"opacity 0.5s linear"};return React.createElement("div",{style:{width:"80vmin",margin:"auto",margin:"2vh auto",height:"10vmin"}},React.createElement("svg",{style:e,id:"brushsvg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 36 36",transform:"scale(-1,1)",onClick:()=>{this.props.setToolFn("brush")}},React.createElement("path",{fill:"#99AAB5",d:"M14.57 27.673c2.814-1.692 6.635-3.807 9.899-7.071 7.03-7.029 12.729-16.97 11.314-18.385C34.369.803 24.428 6.502 17.398 13.531c-3.265 3.265-5.379 7.085-7.071 9.899l4.243 4.243z"}),React.createElement("path",{fill:"#99AAB5",d:"M.428 34.744s7.071 1.414 12.021-3.536c2.121-2.121 2.121-4.949 2.121-4.949l-2.829-2.829s-3.535.708-4.95 2.122c-1.414 1.414-2.518 4.232-2.888 5.598-.676 2.502-3.475 3.594-3.475 3.594z"}),React.createElement("path",{fill:"#23272A",d:"M17.882 25.328l-5.168-5.168c-.391-.391-.958-.326-1.27.145l-1.123 1.705c-.311.471-.271 1.142.087 1.501l4.122 4.123c.358.358 1.03.397 1.501.087l1.705-1.124c.472-.311.536-.878.146-1.269z"}),React.createElement("path",{fill:"#7289DA",d:"M11.229 32.26c-1.191.769-1.826.128-1.609-.609.221-.751-.12-1.648-1.237-1.414-1.117.233-1.856-.354-1.503-1.767.348-1.393-1.085-1.863-1.754-.435-.582 1.16-1.017 2.359-1.222 3.115-.677 2.503-3.476 3.595-3.476 3.595s5.988 1.184 10.801-2.485z"})),React.createElement("button",{name:"brush",style:{padding:"0px",border:"0px",backgroundColor:this.props.selectedColour,width:"10vmin",height:"10vmin",outline:"0px",userSelect:"none"},className:"jscolor {width:243, height:150, borderColor:'#7289DA', insetColor:'#7289DA', backgroundColor:'#23272A', value: '"+this.props.selectedColour+"', valueElement:brushColor, onFineChange:'forceColourChange()'}",id:"brush"},""),React.createElement("input",{id:"brushColor",style:{display:"none"},ref:this.colorSelector}),React.createElement("div",{style:{float:"right"}},React.createElement("svg",{style:s,id:"pencilsvg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 36 36",transform:"rotate(180)",onClick:()=>{this.props.setToolFn("eraser")}},React.createElement("path",{fill:"#23272A",d:"M35.222 33.598c-.647-2.101-1.705-6.059-2.325-7.566-.501-1.216-.969-2.438-1.544-3.014-.575-.575-1.553-.53-2.143.058 0 0-2.469 1.675-3.354 2.783-1.108.882-2.785 3.357-2.785 3.357-.59.59-.635 1.567-.06 2.143.576.575 1.798 1.043 3.015 1.544 1.506.62 5.465 1.676 7.566 2.325.359.11 1.74-1.271 1.63-1.63z"}),React.createElement("path",{fill:"#7289DA",d:"M13.643 5.308c1.151 1.151 1.151 3.016 0 4.167l-4.167 4.168c-1.151 1.15-3.018 1.15-4.167 0L1.141 9.475c-1.15-1.151-1.15-3.016 0-4.167l4.167-4.167c1.15-1.151 3.016-1.151 4.167 0l4.168 4.167z"}),React.createElement("path",{fill:"#99AAB5",d:"M31.353 23.018l-4.17 4.17-4.163 4.165L7.392 15.726l8.335-8.334 15.626 15.626z"}),React.createElement("path",{fill:"#99AAB5",d:"M32.078 34.763s2.709 1.489 3.441.757c.732-.732-.765-3.435-.765-3.435s-2.566.048-2.676 2.678z"}),React.createElement("path",{fill:"#23272A",d:"M2.183 10.517l8.335-8.335 5.208 5.209-8.334 8.335z"}),React.createElement("path",{fill:"#99AAB5",d:"M3.225 11.558l8.334-8.334 1.042 1.042L4.267 12.6zm2.083 2.086l8.335-8.335 1.042 1.042-8.335 8.334z"})),React.createElement("svg",{style:t,id:"xsvg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 36 36",onClick:()=>{this.props.clearFn()}},React.createElement("path",{fill:"#7289DA",d:"M21.533 18.002L33.768 5.768c.976-.976.976-2.559 0-3.535-.977-.977-2.559-.977-3.535 0L17.998 14.467 5.764 2.233c-.976-.977-2.56-.977-3.535 0-.977.976-.977 2.559 0 3.535l12.234 12.234L2.201 30.265c-.977.977-.977 2.559 0 3.535.488.488 1.128.732 1.768.732s1.28-.244 1.768-.732l12.262-12.263 12.234 12.234c.488.488 1.128.732 1.768.732.64 0 1.279-.244 1.768-.732.976-.977.976-2.559 0-3.535L21.533 18.002z"})),React.createElement("div",{className:"submitDiv",style:{position:"relative",display:"inline-block"}},React.createElement("span",{style:_objectSpread(_objectSpread({},o),{},{backgroundColor:"#43b581",opacity:this.props.showSentTooltip?"1":"0"}),id:"sentTooltip",className:"tooltiptext"},"Sent!",React.createElement("div",{style:{position:"absolute",top:"100%",left:"50%",marginLeft:"-1vmin",borderWidth:"1vmin",borderStyle:"solid",borderColor:"#43b581 transparent transparent transparent",width:"0px"}})),React.createElement("span",{style:_objectSpread(_objectSpread({},o),{},{backgroundColor:"#faa61a",opacity:this.props.showFrameTooltip?"1":"0"}),id:"frameTooltip",className:"tooltiptext"},"Save",React.createElement("div",{style:{position:"absolute",top:"100%",left:"50%",marginLeft:"-1vmin",borderWidth:"1vmin",borderStyle:"solid",borderColor:"#faa61a transparent transparent transparent",width:"0px"}})),React.createElement("svg",{style:t,id:"arrowsvg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 36 36",onClick:()=>{this.props.submitFn()}},React.createElement("path",{fill:"#7289DA",d:"M36 32c0 2.209-1.791 4-4 4H4c-2.209 0-4-1.791-4-4V4c0-2.209 1.791-4 4-4h28c2.209 0 4 1.791 4 4v28z"}),React.createElement("path",{fill:"#99AAB5",d:"M7 14h9V7l13 11-13 11v-7H7z"})))))}}